<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>EnergyPulse â€” Smart Energy Predictor</title>
    <meta name="description" content="Predict energy consumption using a trained ML model. Input hour, day, and month to forecast power usage and estimated costs.">
    <link rel="stylesheet" href="/static/css/predict.css">
</head>
<body>

<div class="bg-grid"></div>

<div class="container">

    <!-- Back link -->
    <a href="/" class="back-link">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M19 12H5"/><path d="M12 19l-7-7 7-7"/></svg>
        Back to Dashboard
    </a>

    <!-- Header -->
    <header class="header">
        <div class="header-badge">
            <span class="pulse-dot"></span>
            <span>ML Model Active</span>
        </div>
        <h1>EnergyPulse</h1>
        <p>Predict energy consumption in real time using our trained Linear Regression model</p>
    </header>

    <!-- Main Grid -->
    <div class="main-grid">

        <!-- Input Card -->
        <div class="card">
            <div class="card-title">âš¡ Smart Energy Predictor</div>
            <div class="card-subtitle">Set the time parameters below and hit predict</div>

            <form id="predictForm" onsubmit="return false;">
                <!-- Hour Slider -->
                <div class="form-group">
                    <label class="form-label">
                        <span class="icon">ğŸ•</span> Hour of Day
                    </label>
                    <div class="slider-container">
                        <span class="slider-value" id="hourDisplay">12:00</span>
                        <input type="range" id="hourSlider" min="0" max="23" value="12"
                               oninput="updateHourDisplay(this.value)">
                        <div class="slider-labels">
                            <span>00:00</span>
                            <span>06:00</span>
                            <span>12:00</span>
                            <span>18:00</span>
                            <span>23:00</span>
                        </div>
                    </div>
                </div>

                <!-- Day & Month Selects -->
                <div class="form-group">
                    <div class="select-grid">
                        <div>
                            <label class="form-label">
                                <span class="icon">ğŸ“…</span> Day
                            </label>
                            <select id="daySelect"></select>
                        </div>
                        <div>
                            <label class="form-label">
                                <span class="icon">ğŸ“†</span> Month
                            </label>
                            <select id="monthSelect"></select>
                        </div>
                    </div>
                </div>

                <!-- Predict Button -->
                <button type="button" class="predict-btn" id="predictBtn" onclick="predict()">
                    <span class="btn-text">âš¡ Predict Consumption</span>
                </button>
            </form>
        </div>

        <!-- Results Card -->
        <div class="card results-card">
            <div class="card-title">ğŸ“Š Prediction Results</div>
            <div class="card-subtitle">Forecasted energy metrics will appear here</div>

            <!-- Placeholder -->
            <div class="result-placeholder" id="placeholder">
                <div class="icon-large">ğŸ”®</div>
                <p>Select time parameters and click <strong>Predict</strong> to see live results</p>
            </div>

            <!-- Results -->
            <div class="results-content" id="results">
                <!-- Power Display -->
                <div class="power-display">
                    <div class="power-label">Predicted Power</div>
                    <div class="power-value">
                        <span id="powerValue">0.00</span>
                        <span class="power-unit">kW</span>
                    </div>
                    <div class="power-comparison">
                        <span style="color: var(--text-muted);">vs avg:</span>
                        <span class="comparison-badge" id="compBadge">â€”</span>
                    </div>
                </div>

                <!-- Metrics -->
                <div class="metrics-grid">
                    <div class="metric-card">
                        <div class="metric-icon">ğŸ“Š</div>
                        <div class="metric-value" id="dailyKwh">â€”</div>
                        <div class="metric-label">Daily kWh</div>
                    </div>
                    <div class="metric-card">
                        <div class="metric-icon">ğŸ“ˆ</div>
                        <div class="metric-value" id="monthlyKwh">â€”</div>
                        <div class="metric-label">Monthly kWh</div>
                    </div>
                    <div class="metric-card">
                        <div class="metric-icon">ğŸ’°</div>
                        <div class="metric-value" id="dailyCost">â€”</div>
                        <div class="metric-label">Daily Cost</div>
                    </div>
                    <div class="metric-card">
                        <div class="metric-icon">ğŸ¦</div>
                        <div class="metric-value" id="monthlyCost">â€”</div>
                        <div class="metric-label">Monthly Cost</div>
                    </div>
                </div>

                <!-- Tip -->
                <div class="tip-box">
                    <div class="tip-icon">ğŸ’¡</div>
                    <div>
                        <div class="tip-label">Energy Saving Tip</div>
                        <div class="tip-text" id="tipText">â€”</div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Bottom Stats -->
    <div class="bottom-stats">
        <div class="stat-card">
            <div class="stat-icon">ğŸ§ </div>
            <div class="stat-value">23</div>
            <div class="stat-label">Trained Features</div>
        </div>
        <div class="stat-card">
            <div class="stat-icon">ğŸ“</div>
            <div class="stat-value">0.81</div>
            <div class="stat-label">RÂ² Score</div>
        </div>
        <div class="stat-card">
            <div class="stat-icon">âš™ï¸</div>
            <div class="stat-value">LR</div>
            <div class="stat-label">Active Model</div>
        </div>
    </div>

</div>

<script>
/* â”€â”€ Populate Selects â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
(function() {
    const daySelect = document.getElementById('daySelect');
    const monthSelect = document.getElementById('monthSelect');
    const months = ['January','February','March','April','May','June',
                    'July','August','September','October','November','December'];

    for (let d = 1; d <= 31; d++) {
        const opt = document.createElement('option');
        opt.value = d; opt.textContent = d;
        if (d === 15) opt.selected = true;
        daySelect.appendChild(opt);
    }

    months.forEach((m, i) => {
        const opt = document.createElement('option');
        opt.value = i + 1; opt.textContent = m;
        if (i + 1 === 6) opt.selected = true;
        monthSelect.appendChild(opt);
    });
})();

/* â”€â”€ Hour Display â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
function updateHourDisplay(val) {
    const h = parseInt(val);
    document.getElementById('hourDisplay').textContent =
        h.toString().padStart(2, '0') + ':00';
}

/* â”€â”€ Predict â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
async function predict() {
    const btn = document.getElementById('predictBtn');
    btn.classList.add('loading');
    btn.querySelector('.btn-text').textContent = 'â³ Predictingâ€¦';

    const payload = {
        hour: parseInt(document.getElementById('hourSlider').value),
        day: parseInt(document.getElementById('daySelect').value),
        month: parseInt(document.getElementById('monthSelect').value),
    };

    try {
        const res = await fetch('/api/predict', {
            method: 'POST',
            headers: {'Content-Type': 'application/json'},
            body: JSON.stringify(payload),
        });

        const data = await res.json();
        if (data.error) throw new Error(data.error);

        // Show results
        document.getElementById('placeholder').style.display = 'none';
        document.getElementById('results').classList.add('visible');

        // Power
        animateValue('powerValue', data.predicted_power, 4);

        // Metrics
        document.getElementById('dailyKwh').textContent = data.daily_kwh.toFixed(1);
        document.getElementById('monthlyKwh').textContent = data.monthly_kwh.toFixed(0);
        document.getElementById('dailyCost').textContent = data.currency + data.daily_cost.toFixed(1);
        document.getElementById('monthlyCost').textContent = data.currency + data.monthly_cost.toFixed(0);

        // Comparison badge
        const badge = document.getElementById('compBadge');
        const pct = data.pct_diff;
        if (pct > 0) {
            badge.className = 'comparison-badge above';
            badge.textContent = 'â–² ' + Math.abs(pct).toFixed(1) + '% above avg';
        } else {
            badge.className = 'comparison-badge below';
            badge.textContent = 'â–¼ ' + Math.abs(pct).toFixed(1) + '% below avg';
        }

        // Tip
        document.getElementById('tipText').textContent = data.tip;

    } catch (err) {
        alert('Prediction failed: ' + err.message);
    } finally {
        btn.classList.remove('loading');
        btn.querySelector('.btn-text').textContent = 'âš¡ Predict Consumption';
    }
}

/* â”€â”€ Animate number â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
function animateValue(id, end, decimals) {
    const el = document.getElementById(id);
    const start = parseFloat(el.textContent) || 0;
    const duration = 600;
    const startTime = performance.now();

    function tick(now) {
        const elapsed = now - startTime;
        const progress = Math.min(elapsed / duration, 1);
        const eased = 1 - Math.pow(1 - progress, 3);
        const current = start + (end - start) * eased;
        el.textContent = current.toFixed(decimals);
        if (progress < 1) requestAnimationFrame(tick);
    }

    requestAnimationFrame(tick);
}
</script>

</body>
</html>
